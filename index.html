<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js canvas - interactive - cubes</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #f0f0f0;
				margin: 0px;
				overflow: hidden;
			}
		</style>
	</head>
	<body>

		<script src="three.min.js"></script>

		<script src="stats.min.js"></script>

		<script>

			var container, stats;
			var camera, scene, renderer, scene_width, scene_height;
			var snake;
			var deliciousBall;

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				var info = document.createElement( 'div' );
				info.style.position = 'absolute';
				info.style.top = '10px';
				info.style.width = '100%';
				info.style.textAlign = 'center';
				info.innerHTML = '<a href="http://threejs.org" target="_blank">three.js</a> - orthographic view';
				container.appendChild( info );


				scene_width = 1500;
				scene_height = 1500;
				var cam_width, cam_height;

				if ( window.innerHeight / window.innerWidth  > scene_width / scene_height  ){
					cam_width = scene_width;
					cam_height = scene_height  * window.innerHeight / window.innerWidth;
				}else{
					cam_width = scene_width* window.innerWidth / window.innerHeight;
					cam_height = scene_height ;
				}

				camera = new THREE.OrthographicCamera( cam_width / - 2, cam_width / 2, cam_height / 2, cam_height / - 2, - 500, 1000 );
				//camera.position.x = 200;
				camera.position.y = 200;
				//camera.position.z = 200;

				scene = new THREE.Scene();

				// Grid

				var size = 500, step = 50;

				var geometry = new THREE.Geometry();

				for ( var i = - size; i <= size; i += step ) {

					geometry.vertices.push( new THREE.Vector3( - size, 0, i ) );
					geometry.vertices.push( new THREE.Vector3(   size, 0, i ) );

					geometry.vertices.push( new THREE.Vector3( i, 0, - size ) );
					geometry.vertices.push( new THREE.Vector3( i, 0,   size ) );

				}

				var material = new THREE.LineBasicMaterial( { color: 0x000000, opacity: .1 } );

				var line = new THREE.Line( geometry, material );
				line.type = THREE.LinePieces;
				scene.add( line );

				// Snake

				snake = {angle:0,speed:3,body:[]};

				var geometry = new THREE.SphereGeometry( 30, 10, 3 );
				var material = new THREE.MeshLambertMaterial( { color: 0x440000, shading: THREE.SmoothShading, overdraw: true } );

				for ( var i = 0; i < 2; i ++ ) {

					var sphere = new THREE.Mesh( geometry, material );

					if (i == 0){
						sphere.setMaterial(material.clone());
						sphere.material.color.setHex( 0x112255 );
					}
					sphere.position.x = i * 50 + 25;
					sphere.position.y = 25;
					sphere.position.z = 25;

					snake.body.push(sphere);

					scene.add( sphere );

				}

				deliciousBall = new THREE.Mesh( geometry, material.clone());
				deliciousBall.material.color.setHex(0xaaaa00) ;
				deliciousBall.position.x = Math.random()*1000-500;
				deliciousBall.position.z = Math.random()*1000-500;
				scene.add(deliciousBall);
				// Lights

				var ambientLight = new THREE.AmbientLight( 0xffffff );
				scene.add( ambientLight );

				var directionalLight = new THREE.DirectionalLight( 0xffffff );
				directionalLight.position.x = Math.random() - 0.5;
				directionalLight.position.y = Math.random() - 0.5;
				directionalLight.position.z = Math.random() - 0.5;
				directionalLight.position.normalize();
				scene.add( directionalLight );

				var directionalLight = new THREE.DirectionalLight( 0xffffff );
				directionalLight.position.x = Math.random() - 0.5;
				directionalLight.position.y = Math.random() - 0.5;
				directionalLight.position.z = Math.random() - 0.5;
				directionalLight.position.normalize();
				scene.add( directionalLight );

				renderer = new THREE.CanvasRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild( renderer.domElement );

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				container.appendChild( stats.domElement );

				//
				document.addEventListener( 'keydown', onDocumentKeyDown, false );
				document.addEventListener( 'keyup', onDocumentKeyUp, false );

				window.addEventListener( 'resize', onWindowResize, false );

			}
			function onDocumentKeyDown( event ) {

				switch( event.keyCode ) {
					//left, up, right, down
					case 37: snake.angle +=.1; break;
					case 38: snake.speed *=1.5; break; 
					case 39: snake.angle -=.1; break; 
					case 40: snake.speed /=1.5; break; 

				}

			}

			function onDocumentKeyUp( event ) {

				switch( event.keyCode ) {

					case 16: isShiftDown = false; break;
					case 17: isCtrlDown = false; break;

				}
			}
			function onWindowResize() {

				var cam_width, cam_height;

				if ( window.innerHeight / window.innerWidth  > scene_width / scene_height  ){
					cam_width = scene_width;
					cam_height = scene_height  * window.innerHeight / window.innerWidth;
				}else{
					cam_width = scene_width* window.innerWidth / window.innerHeight;
					cam_height = scene_height ;
				}

				camera.left = cam_width / - 2;
				camera.right = cam_width / 2;
				camera.top = cam_height / 2;
				camera.bottom = cam_height / - 2;

				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			//

			function animate() {

				requestAnimationFrame( animate );

				updateSnake();
				gameLogic();
				render();
				stats.update();

			}

			function gameLogic(){
				var hp = snake.body[0].position;
				var dbp = deliciousBall.position;
				var dx = dbp.x-hp.x;
				var dy = dbp.z-hp.z;
				if (Math.sqrt(dx*dx + dy*dy) < 50){
					//got the ball!
					snake.angle = Math.atan2(dx,dy);
					snake.body.push(new THREE.Mesh(snake.body[1].geometry, snake.body[1].material));
					scene.add(snake.body[snake.body.length - 1]);
					for(var i = snake.body.length - 1; i > 0; i--){
					snake.body[i].position.x = snake.body[i-1].position.x;
					snake.body[i].position.z = snake.body[i-1].position.z;						
					}
					snake.body[0].position.x = dbp.x;
					snake.body[0].position.z = dbp.z;
					deliciousBall.position.x = Math.random()*1000-500;
					deliciousBall.position.z = Math.random()*1000-500;
				}
			}


			function updateSnake() {
				var vx = Math.sin(snake.angle)*snake.speed;
				var vz = Math.cos(snake.angle)*snake.speed;

				snake.body[0].position.x += vx;
				snake.body[0].position.z += vz;
				var diff = 50;
				for (var i = 1; i < snake.body.length; i++){
					var dx = snake.body[i-1].position.x - snake.body[i].position.x;
					var dz = snake.body[i-1].position.z - snake.body[i].position.z;
					var l = Math.sqrt(dx*dx + dz*dz);
					var ux = dx*diff/l;
					var uz = dz*diff/l;
					snake.body[i].position.x = snake.body[i-1].position.x - ux;
					snake.body[i].position.z = snake.body[i-1].position.z - uz;
				}
			}
			function render() {

				var timer = Date.now() * 0.0001;

				camera.rotation.x = Math.cos( timer ) * 200;
				//camera.position.z = Math.sin( timer ) * 200;
				camera.lookAt( scene.position );



				renderer.render( scene, camera );

			}

		</script>

	</body>
</html>
